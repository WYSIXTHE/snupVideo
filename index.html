<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VideoLinki ‚Äì Wideoteka</title>
  <style>
    :root {
      --bg:#0b0d10;
      --panel:#141820;
      --card:#1a1f2b;
      --muted:#9aa4b2;
      --text:#e6e9ee;
      --acc:#6ea8fe;
      --danger:#ff6464;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body {
      font-family:system-ui,Roboto,Arial,sans-serif;
      background:linear-gradient(90deg,#0b0d10,#0f1320);
      color:var(--text);
      display:flex;
      height:100vh;
      overflow:hidden;
    }
    /* PANEL LEWY */
    aside {
      width:300px;
      background:var(--panel);
      border-right:1px solid #1f2633;
      display:flex;
      flex-direction:column;
      padding:20px;
      gap:16px;
    }
    aside h1 { font-size:18px; margin-bottom:10px; }
    aside form { display:flex; flex-direction:column; gap:10px; }
    input, textarea {
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #223148;
      background:#0d1220;
      color:var(--text);
    }
    input::placeholder, textarea::placeholder { color:#6f7d92; }
    button {
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #24418c;
      background:linear-gradient(180deg,#1c3c8d,#142b63);
      color:#fff;
      font-weight:600;
      cursor:pointer;
    }
    button:hover { filter:brightness(1.1); }
    .danger { border:1px solid #802828; background:linear-gradient(180deg,#a22,#711); }
    .chip { font-size:13px; padding:6px 10px; border-radius:999px; border:1px solid #263145; background:#0b0d10; color:var(--muted); display:inline-block; }

    /* GALERIA */
    main {
      flex:1;
      overflow:auto;
      padding:20px;
    }
    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
      gap:16px;
    }
    .card {
      background:var(--card);
      border:1px solid #1f2633;
      border-radius:12px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .thumb {
      position:relative;
      aspect-ratio:16/9;
      background:#0c111b;
      display:grid;
      place-items:center;
    }
    .thumb img { width:100%; height:100%; object-fit:cover; }
    .thumb .play {
      position:absolute; inset:0;
      display:grid; place-items:center;
    }
    .thumb .play button {
      width:48px; height:48px;
      border-radius:999px;
      border:1px solid #2c3750;
      background:rgba(20,24,32,.65);
    }
    .thumb .play button:hover { outline:2px solid #2c6fff3a; }
    .meta { padding:10px; font-size:14px; }
    .meta .title { font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .meta .url { font-size:12px; color:var(--muted); overflow:hidden; text-overflow:ellipsis; }

    /* MODAL pe≈Çnoekranowy */
    dialog {
      position:fixed;
      inset:0;
      margin:0;
      width:100%;
      height:100%;
      border:none;
      border-radius:0;
      padding:0;
      background:#0b0d10;
      display:flex;
      flex-direction:column;
    }
    dialog::backdrop { background:rgba(3,6,15,.7); }
    .player-head {
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 16px;
      border-bottom:1px solid #1f2633;
    }
    .player-body {
      flex:1;
      display:flex;
      justify-content:center;
      align-items:center;
      background:#000;
    }
    .player-body iframe, 
    .player-body video {
      width:100%;
      height:100%;
      max-height:100%;
      max-width:100%;
      object-fit:contain;
    }
    .comments {
      padding:12px;
      border-top:1px solid #1f2633;
      max-height:30%;
      overflow-y:auto;
      background:#141820;
    }
    .comment { 
      margin-bottom:8px;
      color:#fff;
      padding:6px 8px;
      background:#1a1f2c;
      border-radius:6px;
    }
    .comment strong { color:var(--acc); margin-right:6px; }
    .comment-form {
      display:flex; gap:8px; padding:10px; border-top:1px solid #1f2633;
      background:#141820;
    }
    .comment-form input {
      flex:1;
    }
    footer {
      font-size:12px; color:var(--muted);
      text-align:center; margin-top:auto;
    }
  </style>
</head>
<body>
  <!-- PANEL LEWY -->
  <aside>
    <h1>üé¨ VideoLinki</h1>
    <form id="addForm">
      <input id="urlInput" type="url" placeholder="Link do filmu (YouTube/Vimeo/mp4)" required>
      <input id="titleInput" type="text" placeholder="Tytu≈Ç (opcjonalny)">
      <button type="submit">‚ûï Dodaj</button>
    </form>
    <div><span id="countChip" class="chip">0 film√≥w</span></div>
    <button id="clearBtn" class="danger">üóëÔ∏è Wyczy≈õƒá wszystko</button>
    <input id="searchInput" type="text" placeholder="üîç Szukaj...">
    <footer>Zapis lokalny w przeglƒÖdarce</footer>
  </aside>

  <!-- GALERIA -->
  <main>
    <div id="grid" class="grid"></div>
  </main>

  <!-- ODTWARZACZ -->
  <dialog id="player">
    <div class="player-head">
      <div>
        <div id="playerTitle" style="font-weight:600"></div>
        <div id="playerSub" style="font-size:12px;opacity:.7"></div>
      </div>
      <button id="closeBtn" class="chip">‚úñ Zamknij</button>
    </div>
    <div class="player-body" id="playerBody"></div>

    <!-- KOMENTARZE -->
    <div class="comments" id="commentsList"></div>
    <form class="comment-form" id="commentForm">
      <input id="commentInput" type="text" placeholder="Dodaj komentarz..." required>
      <button type="submit">üí¨</button>
    </form>
  </dialog>

  <script>
    const $ = s => document.querySelector(s);
    const dbKey = 'videolinki.v2';
    const commentsKey = 'videolinki.comments.v1';
    let items = JSON.parse(localStorage.getItem(dbKey) || '[]');
    let comments = JSON.parse(localStorage.getItem(commentsKey) || '{}');
    let currentId = null;

    function save(){ localStorage.setItem(dbKey, JSON.stringify(items)); }
    function saveComments(){ localStorage.setItem(commentsKey, JSON.stringify(comments)); }
    function fmtCount(n){ return n===1? "1 film" : (n<5? n+" filmy" : n+" film√≥w"); }

    function parseUrl(raw){
      try{ const url = new URL(raw);
        if(url.hostname.includes('youtube')||url.hostname==='youtu.be'){
          let id=url.searchParams.get('v'); if(!id) id=url.pathname.split('/').pop();
          return {type:'yt',embed:`https://www.youtube.com/embed/${id}`,thumb:`https://img.youtube.com/vi/${id}/hqdefault.jpg`};
        }
        if(url.hostname.includes('vimeo')){
          let id=url.pathname.split('/').filter(Boolean).pop();
          return {type:'vimeo',embed:`https://player.vimeo.com/video/${id}`};
        }
        if(/\.(mp4|webm|ogg)$/i.test(url.pathname)){ return {type:'file',src:url.toString()}; }
        return {type:'iframe',embed:url.toString()};
      }catch{ return {type:'unknown'}; }
    }

    function render(){
      const grid=$('#grid'); grid.innerHTML='';
      const q=$('#searchInput').value.toLowerCase();
      const filtered=items.filter(i=>i.title.toLowerCase().includes(q)||i.url.toLowerCase().includes(q));
      $('#countChip').textContent=fmtCount(filtered.length);
      for(const it of filtered){
        const card=document.createElement('div'); card.className='card';
        const thumb=document.createElement('div'); thumb.className='thumb';
        if(it.thumb){ let img=new Image(); img.src=it.thumb; thumb.appendChild(img); }
        const play=document.createElement('div'); play.className='play';
        const btn=document.createElement('button'); play.appendChild(btn); thumb.appendChild(play);
        const meta=document.createElement('div'); meta.className='meta';
        meta.innerHTML=`<div class="title">${it.title}</div><div class="url">${it.url}</div>`;
        card.appendChild(thumb); card.appendChild(meta); grid.appendChild(card);
        btn.onclick=()=>openPlayer(it);
      }
    }

    function renderComments(id){
      const list=$('#commentsList');
      list.innerHTML='';
      const arr=comments[id]||[];
      arr.forEach((c,i)=>{
        const div=document.createElement('div');
        div.className='comment';
        div.innerHTML=`<strong>Anonimowy-${i+1}:</strong> ${c}`;
        list.appendChild(div);
      });
    }

    function openPlayer(it){
      currentId=it.id;
      $('#playerTitle').textContent=it.title;
      $('#playerSub').textContent=it.url;
      $('#playerBody').innerHTML='';
      if(it.type==='yt'||it.type==='vimeo'||it.type==='iframe'){
        const f=document.createElement('iframe'); f.src=it.embed; f.allowFullscreen=true; f.frameBorder=0;
        $('#playerBody').appendChild(f);
      } else if(it.type==='file'){
        const v=document.createElement('video'); v.src=it.src; v.controls=true; v.play();
        $('#playerBody').appendChild(v);
      }
      renderComments(it.id);
      $('#player').showModal();
    }

    $('#closeBtn').onclick=()=>$('#player').close();
    $('#addForm').onsubmit=e=>{
      e.preventDefault();
      const url=$('#urlInput').value.trim(); if(!url) return;
      const parsed=parseUrl(url);
      const rec={id:Math.random().toString(36).slice(2),url,title:$('#titleInput').value.trim()||url,...parsed};
      items.unshift(rec); save(); render(); e.target.reset();
    };
    $('#clearBtn').onclick=()=>{ if(confirm('Na pewno usunƒÖƒá wszystkie?')){ items=[]; save(); render(); } };
    $('#searchInput').oninput=render;

    $('#commentForm').onsubmit=e=>{
      e.preventDefault();
      if(!currentId) return;
      const txt=$('#commentInput').value.trim(); if(!txt) return;
      comments[currentId]=comments[currentId]||[];
      comments[currentId].push(txt);
      saveComments();
      $('#commentInput').value='';
      renderComments(currentId);
    };

    render();
  </script>
</body>
</html>
