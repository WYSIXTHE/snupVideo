<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VideoLinki ‚Äì Twoja mini-wideoteka</title>
  <style>
    :root{
      --bg:#0b0d10;--card:#141820;--muted:#9aa4b2;--text:#e6e9ee;--acc:#6ea8fe;--danger:#ff6464
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;
      background:linear-gradient(180deg,#0b0d10,#0f1320);color:var(--text)}
    header{position:sticky;top:0;background:rgba(11,13,16,.75);backdrop-filter:saturate(150%) blur(8px);
      border-bottom:1px solid #1f2633;z-index:5}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid #1f2633;border-radius:16px;overflow:hidden;
      box-shadow:0 6px 22px rgba(0,0,0,.25)}
    .thumb{position:relative;aspect-ratio:16/9;background:#0c111b;display:grid;place-items:center}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .thumb .badge{position:absolute;top:10px;left:10px;font-size:12px;background:#0b0d10dd;
      border:1px solid #263145;color:#c7d2e0;padding:4px 8px;border-radius:999px}
    .thumb .play{position:absolute;inset:0;display:grid;place-items:center}
    .thumb .play button{width:56px;height:56px;border-radius:999px;border:1px solid #2c3750;
      background:rgba(20,24,32,.65);cursor:pointer}
    .thumb .play button:hover{outline:2px solid #2c6fff3a}
    .meta{padding:12px 14px}
    .title{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .url{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:4px}
    .row{display:flex;gap:10px;align-items:center}
    form{display:grid;grid-template-columns:1.5fr 1fr auto;gap:10px}
    input[type="url"],input[type="text"]{width:100%;padding:12px 12px;border-radius:12px;
      border:1px solid #223148;background:#0d1220;color:var(--text)}
    input::placeholder{color:#6f7d92}
    button.add{padding:12px 16px;border-radius:12px;border:1px solid #24418c;
      background:linear-gradient(180deg,#1c3c8d,#142b63);color:#fff;font-weight:600;cursor:pointer}
    button.add:hover{filter:brightness(1.08)}
    .toolbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:12px}
    .chip{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid #263145;
      color:#c7d2e0;background:#0b0d10}
    .search{flex:1}
    .search input{width:100%;padding:10px 12px;border-radius:999px;border:1px solid #263145;
      background:#0b0d10;color:#c7d2e0}
    dialog#player{width:96vw;max-width:1200px;border:none;border-radius:16px;padding:0;
      overflow:hidden;background:#0b0d10;display:flex;flex-direction:column}
    dialog::backdrop{background:rgba(3,6,15,.7)}
    .player-head{display:flex;justify-content:space-between;align-items:center;
      padding:10px 14px;border-bottom:1px solid #1f2633}
    .player-body{flex:1;display:flex;justify-content:center;align-items:center;padding:0;background:#000}
    .player-body iframe,.player-body video{width:100%;height:70vh;display:block;background:#000}
    .comments{border-top:1px solid #1f2633;padding:12px;max-height:200px;overflow-y:auto}
    .comment{color:#fff;margin:4px 0;padding:6px 10px;background:#1a1f2c;border-radius:8px}
    .comment-form{display:flex;gap:8px;margin-top:8px}
    .comment-form input{flex:1;padding:8px;border-radius:8px;border:1px solid #263145;background:#0d1220;color:#fff}
    .comment-form button{padding:8px 12px;border-radius:8px;background:#24418c;color:#fff;border:none;cursor:pointer}
    .danger{color:var(--danger);cursor:pointer}
    .hidden{display:none}
    .empty{opacity:.6;display:grid;place-items:center;padding:40px;border:1px dashed #263145;border-radius:16px}
    footer{opacity:.7;font-size:12px;text-align:center;margin:40px 0}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="row" style="justify-content:space-between">
        <h1>üé¨ VideoLinki ‚Äì dodaj link i oglƒÖdaj</h1>
        <button id="exportBtn" class="chip">üì§ Eksport</button>
      </div>
      <form id="addForm" autocomplete="off" style="margin-top:12px">
        <input id="urlInput" type="url" placeholder="Wklej link (YouTube, Vimeo, .mp4/.webm)‚Ä¶" required />
        <input id="titleInput" type="text" placeholder="Tytu≈Ç (opcjonalnie)" />
        <button class="add" type="submit">‚ûï Dodaj</button>
      </form>
    </div>
  </header>

  <main class="wrap" style="margin-top:14px">
    <div id="emptyState" class="empty">Brak film√≥w. Dodaj pierwszy link powy≈ºej. ‚ú®</div>
    <div id="grid" class="grid"></div>
  </main>

  <dialog id="player">
    <div class="player-head">
      <div>
        <div id="playerTitle" style="font-weight:600"></div>
        <div id="playerSub" style="font-size:12px;opacity:.7"></div>
      </div>
      <div class="row">
        <button id="deleteBtn" class="chip danger">üóëÔ∏è Usu≈Ñ</button>
        <button id="closeBtn" class="chip">‚úñÔ∏è Zamknij</button>
      </div>
    </div>
    <div class="player-body" id="playerBody"></div>
    <div class="comments" id="commentsList"></div>
    <form class="comment-form" id="commentForm">
      <input type="text" id="commentInput" placeholder="Dodaj komentarz‚Ä¶" />
      <button type="submit">‚û§</button>
    </form>
  </dialog>

  <footer>Zapis dzia≈Ça lokalnie w przeglƒÖdarce (localStorage).</footer>

  <script>
    const dbKey='videolinki.items.v1'
    const $=s=>document.querySelector(s)
    let items=JSON.parse(localStorage.getItem(dbKey)||'[]')
    let currentId=null
    let anonCounter=1

    function save(){localStorage.setItem(dbKey,JSON.stringify(items))}
    function createId(){return Math.random().toString(36).slice(2)}
    function parseUrl(raw){
      try{
        const u=new URL(raw);const h=u.hostname.replace('www.','')
        if(h.includes('youtube.com')||h==='youtu.be'){
          let id=u.searchParams.get('v')
          if(!id&&h==='youtu.be')id=u.pathname.slice(1)
          if(!id&&u.pathname.startsWith('/shorts/'))id=u.pathname.split('/')[2]
          if(id)return{type:'youtube',embed:`https://www.youtube.com/embed/${id}`,thumb:`https://img.youtube.com/vi/${id}/hqdefault.jpg`}
        }
        if(h.includes('vimeo.com')){
          const id=u.pathname.split('/').filter(Boolean).find(p=>/^\d+$/.test(p))
          if(id)return{type:'vimeo',embed:`https://player.vimeo.com/video/${id}`}
        }
        if(/[.](mp4|webm|ogg)(?:$|\?)/i.test(u.pathname))
          return{type:'file',src:u.toString()}
        return{type:'iframe',embed:u.toString()}
      }catch{return{type:'unknown'}}
    }

    function render(){
      const grid=$('#grid');grid.innerHTML=''
      if(!items.length)$('#emptyState').classList.remove('hidden')
      else $('#emptyState').classList.add('hidden')
      items.forEach(it=>{
        const card=document.createElement('article');card.className='card'
        card.innerHTML=`<div class="thumb">
          <span class="badge">${it.kind}</span>
          ${it.thumb?`<img src="${it.thumb}">`:'<div class="ghost">Brak miniatury</div>'}
          <div class="play"><button title="Odtw√≥rz"></button></div>
        </div>
        <div class="meta"><div class="title">${it.title}</div>
        <div class="url">${it.url}</div></div>`
        card.querySelector('button').onclick=()=>openPlayer(it.id)
        grid.appendChild(card)
      })
    }

    function openPlayer(id){
      const it=items.find(x=>x.id===id);if(!it)return
      currentId=id
      $('#playerTitle').textContent=it.title
      $('#playerSub').textContent=it.url
      const body=$('#playerBody');body.innerHTML=''
      if(it.kind==='YOUTUBE'||it.kind==='VIMEO'||it.kind==='IFRAME'){
        const f=document.createElement('iframe');f.src=it.embed
        f.allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture"
        f.allowFullscreen=true;f.frameBorder="0";body.appendChild(f)
      }else if(it.kind==='FILE'){
        const v=document.createElement('video');v.src=it.src;v.controls=true;v.autoplay=true
        body.appendChild(v)
      }
      // render comments
      const cl=$('#commentsList');cl.innerHTML=''
      it.comments?.forEach(c=>{
        const div=document.createElement('div');div.className='comment'
        div.textContent=c;cl.appendChild(div)
      })
      $('#player').showModal()
    }

    $('#addForm').onsubmit=e=>{
      e.preventDefault()
      const url=$('#urlInput').value.trim(),title=$('#titleInput').value.trim()||url
      const p=parseUrl(url)
      const rec={id:createId(),url,title,comments:[],kind:p.type.toUpperCase()}
      if(p.embed)rec.embed=p.embed;if(p.thumb)rec.thumb=p.thumb;if(p.src)rec.src=p.src
      items.unshift(rec);save();render();e.target.reset()
    }
    $('#closeBtn').onclick=()=>$('#player').close()
    $('#deleteBtn').onclick=()=>{
      if(currentId){items=items.filter(x=>x.id!==currentId);save();render();$('#player').close()}
    }
    $('#commentForm').onsubmit=e=>{
      e.preventDefault()
      const txt=$('#commentInput').value.trim();if(!txt)return
      const it=items.find(x=>x.id===currentId);if(!it)return
      const name=`Anonimowy-${anonCounter++}`
      it.comments.push(`${name}: ${txt}`);save()
      $('#commentInput').value='';openPlayer(currentId)
    }
    render()
  </script>
</body>
</html>
